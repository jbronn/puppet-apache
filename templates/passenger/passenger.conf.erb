<IfModule mod_passenger.c>
  PassengerRoot <%= scope.lookupvar('ruby::passenger::root') %>
  PassengerRuby /usr/bin/ruby
  # Recommended Passenger Configuration
  PassengerHighPerformance on
<%# PassengerUseGlobalQueue deprecated in Passenger 4 and above. -%>
<% if scope.lookupvar('ruby::passenger::version').start_with? '3' -%>
  PassengerUseGlobalQueue on
<% end -%>
  # PassengerMaxPoolSize control number of application instances,
  # typically 1.5x the number of processor cores.
  PassengerMaxPoolSize <%= @max_pool_size %>

<% if @stat_throttle_rate -%>
  # Reduces filesystem I/O (`stat` calls) to once this many seconds.
  PassengerStatThrottleRate <%= @stat_throttle_rate %>
<% end -%>
<% if @pool_idle_time -%>
  # Maximum time an application instance may be idle.
  PassengerPoolIdleTime <%= @pool_idle_time %>
<% end -%>
<% if @max_requests -%>
  # Restart ruby process after handling specific number of
  # requests to resolve MRI memory leak.
  PassengerMaxRequests <%= @max_requests %>
<% end -%>
</IfModule>
